---
- name: 'Clone/Update latest repo'
  git: repo={{ github_repo }}
      dest={{ webapps_dir }}
      accept_hostkey=yes
  become: yes
  become_user: "{{ user }}"

- name: 'Ensure mem split'
  become: yes
  pi_boot_config: config_vals=gpu_mem={{raspi_config_memory_split_gpu}}
  notify:
    - Apply raspi-config

- name: 'Set camera state'
  include: camera.yml

- name: 'Crontab entry for camera sub'
  become: yes
  cron: name="camera sub " minute="0" hour="*" job="/usr/bin/aws s3 mv /tmp/ s3://archive.snerted.com/ --recursive --exclude '*' --include '{{ snapshot_topic }}_*.png'"

- name: 'Supervisor script for camera monitor'
  become: yes
  template: src=camera_sub.conf.j2 dest=/etc/supervisor/conf.d/camera_sub.conf mode=0644
  with_dict: "{{ videos }}"
  notify:
    - restart supervisord
